{% extends "kontakti/base.html" %}

{% block title %}Kontakti sa pacijentima{% endblock %}

{% block content %}

{% if user.is_authenticated %}

<br>
<h3>Pacijenti...</h3> 
<form action="{% url 'search' %} " class="col-md-3 pb-2 d-flex" role="search" method="post">
  {% csrf_token %}
  <input class="form-control me-6" type="text" name="search_term" placeholder="deo ili celo prezime">
  <button class="btn btn-secondary" type="submit">Traži</button>
</form>

<table class="table table-striped table-bordered table-responsive-sm">
  <tr class="table-success">
    <th>Pacijent</th>
    <th>Datum rođenja (starost)</th>
    <th>doctor</th>
    <th>dijagnoza</th>
    <th>anestezija</th>
    <th>poslednji kontakt</th>
    <th>&NonBreakingSpace;</th>
  </tr>

  {% for patient in patients %}

  <tr>
    <td><a href="{% url 'patient' patient.id %}">
        {{ patient.first_name}} {{ patient.last_name}}
      </a></td>
    <td>{{ patient.date_of_birth|date:"d.m.Y" }} ({{ patient.age|floatformat:"1" }})</td>
    <td>{{ patient.doctor }}</td>
    <td>{{ patient.diagnose }}</td>
    <td>{% if patient.anestezija == True %}
      opšta
      {% else %}
      lokalna
      {% endif %}
    </td>
    <td>{{ patient.last_contact_date_time|date:"d.m.Y" }} {{ patient.last_contact_date_time|time:"H:i" }}</td>
    <td>
      <a class="btn btn-secondary" href="{% url 'edit_patient' patient.id %}">Promeni</a>
      <a class="btn btn-danger" href="{% url 'delete_patient' patient.id %}" onclick="return confirm('Da li ste sigurni da želite da izbrišete pacijenta {{ patient }}?');">Izbriši</a>
    </td>
  </tr>

  {% endfor %}

</table>

<p><a class="btn btn-secondary" href="{% url 'add_patient'%}">Dodaj pacijenta</a></p>

{% else %}

<div class="col-md-6 offset-md-3 border p-4 mt-4 mb-4 bg-body-tertiary">
  <h1>Login</h1>

  <form action="{% url 'index' %} " method="post">
    {% csrf_token %}
    <div class="mb-3">
      <input type="text" name="username" class="form-control" placeholder="Username" required>
    </div>
    <div class="mb-3">
      <input type="password" name="password" class="form-control" placeholder="Password" required>
    </div>
    <button type="submit" class="btn btn-secondary">Login</button>
  </form>

</div>

{% endif %}

<script>
  function confirmDelete() {
      return confirm("Are you sure you want to delete this item?");
  }
</script>

{% endblock%}